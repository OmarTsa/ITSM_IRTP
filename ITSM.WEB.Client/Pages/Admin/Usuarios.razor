@page "/admin/usuarios"
@using ITSM.Entidades
@using ITSM.WEB.Client.Servicios
@using MudBlazor
@inject UsuarioServicio _usuarioServicio
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

@rendermode InteractiveWebAssembly

<MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-4">
    <MudText Typo="Typo.h5"><b>Gestión de Usuarios</b></MudText>
    <MudSpacer />
    <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.PersonAdd"
               OnClick="@(() => Navigation.NavigateTo("/admin/usuarios/nuevo"))">
        Nuevo Usuario
    </MudButton>
</MudStack>

<MudTable Items="@usuarios" Hover="true" Bordered="true" Striped="true" Elevation="3" Loading="@loading">
    <HeaderContent>
        <MudTh>DNI</MudTh>
        <MudTh>Nombres y Apellidos</MudTh>
        <MudTh>Nombre de Usuario</MudTh>
        <MudTh>Correo</MudTh>
        <MudTh>Estado</MudTh>
        <MudTh>Acciones</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="DNI">@context.Dni</MudTd>
        <MudTd DataLabel="Nombre"><b>@context.NombreCompleto</b></MudTd>
        <MudTd DataLabel="Username">@context.Username</MudTd>
        <MudTd DataLabel="Correo">@context.Email</MudTd>
        <MudTd DataLabel="Estado">
            @if (context.Activo == 1)
            {
                <MudChip T="string" Color="Color.Success" Size="Size.Small">Activo</MudChip>
            }
            else
            {
                <MudChip T="string" Color="Color.Error" Size="Size.Small">Inactivo</MudChip>
            }
        </MudTd>
        <MudTd DataLabel="Acciones">
            <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Warning"
                           OnClick="@(() => Navigation.NavigateTo($"/admin/usuarios/editar/{context.IdUsuario}"))" />
        </MudTd>
    </RowTemplate>
</MudTable>

@code {
    private List<Usuario> usuarios = new();
    private bool loading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            usuarios = await _usuarioServicio.ListarUsuarios();
        }
        finally
        {
            loading = false;
        }
    }
}